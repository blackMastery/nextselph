// we create a variable to store the class
// otherwise we get a redeclaration error e.g let a = 2 will fail if we do
// let a = 2 - the same happens with the class keyword when the script is conditionally reloaded
var SelphShim;

if (!SelphShim) {
  SelphShim = class {
    init = async (selphid, isProduction) => {
      this.selphid = selphid;
      this.server = isProduction
        ? "https://api.trueselph.com"
        : "http://localhost:3000";
      this.siteURL = isProduction
        ? "https://app.trueselph.com"
        : "http://localhost:3002";

      // check if selph is in registry
      this.published = await fetch(
        `${this.server}/registry/${this.selphid}/presence`,
        {
          headers: {
            Authorization: "Bearer " + localStorage.getItem("token"),
          },
        }
      )
        .then((res) => {
          return res.json();
        })
        .then((res) => {
          this.mountMessengerWidget(res.present);
          this.published = res.present;
          return res.published;
        });

      this.mountMessengerIframe();
    };

    mountMessengerIframe = () => {
      this.frameOpen = false;
      const iframe = document.createElement("iframe");

      iframe.src = `http://localhost:3002/selph/interact/${this.selphid}`;
      iframe.src = `${this.siteURL}/selph/interact/${this.selphid}`;
      iframe.crossorigin = "anonymous";
      iframe.allow = "microphone *";
      iframe.style.overflow = "hidden";
      iframe.width = "375px";
      iframe.height = "100%";
      iframe.style.border = "none";
      iframe.style.borderRadius = "3px";
      iframe.allowFullscreen = true;
      iframe.allowTransparency = true;
      this.iframe = iframe;

      const wrapper = document.createElement("div");
      wrapper.id = "selph-messenger-iframe-container";
      wrapper.className = "selph-messenger-iframe-container";

      wrapper.style.width = "375px";
      wrapper.style.height = 0;
      wrapper.style.position = "fixed";
      wrapper.style.right = 0;
      wrapper.style.top = 0;
      wrapper.style.zIndex = 99999;
      wrapper.style.boxShadow =
        "rgb(0 0 0 / 44%) 7px 6px 9px 0px, rgb(0 0 0 / 34%) 0px 2px 32px";
      wrapper.appendChild(this.iframe);
      this.wrapper = wrapper;
      document.body.appendChild(wrapper);
    };

    mountUnpublishedIndicator = () => {
      const indicatorEl = document.createElement("div");
      const indicatorMessage = "Selph not published.";
      const indicatorMessageEl = document.createElement("p");
      const widget = document.getElementById("selph-messenger-widget");

      indicatorMessageEl.textContent = indicatorMessage;

      indicatorEl.style.position = "absolute";
      indicatorEl.style.top = "-80px";
      indicatorEl.style.display = "inline-block";
      indicatorEl.style.width = "200px";
      indicatorEl.style.paddingRight = "10px";
      indicatorEl.style.paddingLeft = "10px";
      indicatorEl.style.borderRadius = "10px";
      indicatorEl.style.background = "#00000090";
      indicatorEl.style.right = 0;
      indicatorEl.style.color = "#fff";
      indicatorEl.style.fontWeight = "bold";
      indicatorEl.appendChild(indicatorMessageEl);

      widget.appendChild(indicatorEl);
    };

    mountMessengerWidget = (published) => {
      const widget = document.createElement("div");
      widget.id = "selph-messenger-widget";
      widget.style.position = "fixed";
      widget.style.bottom = "50px";
      widget.style.right = "50px";
      widget.style.padding = 0;
      widget.style.width = "50px";
      widget.style.height = "50px";
      widget.style.borderRadius = "5px";
      widget.style.zIndex = 999999;
      widget.style.cursor = "pointer";
      widget.style.boxShadow =
        "rgb(0 0 0 / 44%) 7px 6px 9px 0px, rgb(0 0 0 / 34%) 0px 2px 32px";
      if (published) {
        widget.addEventListener("click", () =>
          this.toggleMessengerIframe(published)
        );
      }
      this.widgetDefaultIcon = `<svg id="svg" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="50" height="50" viewBox="0, 0, 400,400"><g id="svgg"><path id="path0" d="M17.400 0.400 C 17.264 0.620,17.523 0.800,17.976 0.800 C 18.429 0.800,18.800 0.620,18.800 0.400 C 18.800 0.180,18.541 0.000,18.224 0.000 C 17.907 0.000,17.536 0.180,17.400 0.400 M381.200 0.400 C 381.200 0.919,382.279 0.919,382.600 0.400 C 382.736 0.180,382.477 -0.000,382.024 -0.000 C 381.571 -0.000,381.200 0.180,381.200 0.400 M13.996 1.404 C 13.585 1.900,13.645 2.000,14.351 2.000 C 14.818 2.000,15.200 1.831,15.200 1.624 C 15.200 0.931,14.496 0.802,13.996 1.404 M385.055 1.400 C 384.900 1.806,385.076 2.000,385.600 2.000 C 386.124 2.000,386.300 1.806,386.145 1.400 C 386.018 1.070,385.773 0.800,385.600 0.800 C 385.427 0.800,385.182 1.070,385.055 1.400 M11.461 2.585 C 11.366 2.833,11.628 3.062,12.044 3.093 C 12.460 3.125,12.800 2.921,12.800 2.642 C 12.800 2.013,11.699 1.966,11.461 2.585 M8.000 5.000 C 7.584 5.501,7.642 5.600,8.351 5.600 C 8.839 5.600,9.200 5.345,9.200 5.000 C 9.200 4.670,9.042 4.400,8.849 4.400 C 8.656 4.400,8.274 4.670,8.000 5.000 M390.996 4.807 C 390.630 5.399,390.977 5.702,391.831 5.535 C 392.456 5.413,392.463 5.349,391.898 4.881 C 391.448 4.508,391.193 4.487,390.996 4.807 M4.881 8.102 C 4.508 8.552,4.487 8.807,4.807 9.004 C 5.399 9.370,5.702 9.023,5.535 8.169 C 5.413 7.544,5.349 7.537,4.881 8.102 M394.800 8.600 C 394.800 8.930,394.980 9.200,395.200 9.200 C 395.420 9.200,395.600 8.930,395.600 8.600 C 395.600 8.270,395.420 8.000,395.200 8.000 C 394.980 8.000,394.800 8.270,394.800 8.600 M2.500 11.465 C 1.810 11.743,1.869 12.800,2.575 12.800 C 2.904 12.800,3.124 12.457,3.090 12.000 C 3.057 11.560,3.023 11.214,3.015 11.232 C 3.007 11.249,2.775 11.354,2.500 11.465 M0.000 17.976 C 0.000 18.429,0.180 18.800,0.400 18.800 C 0.620 18.800,0.800 18.541,0.800 18.224 C 0.800 17.907,0.620 17.536,0.400 17.400 C 0.180 17.264,0.000 17.523,0.000 17.976 M164.644 138.281 C 159.983 139.704,152.800 145.816,152.800 148.359 C 152.800 148.534,152.485 149.290,152.100 150.039 C 151.457 151.290,151.400 153.309,151.400 175.000 L 151.400 198.600 152.778 201.400 C 155.223 206.369,159.791 210.269,164.908 211.756 C 166.863 212.324,170.947 212.401,199.662 212.406 C 217.558 212.409,232.427 212.556,232.704 212.732 C 233.100 212.984,233.186 216.952,233.104 231.226 L 233.000 249.400 200.700 249.502 L 168.400 249.605 168.400 241.651 C 168.400 235.388,168.283 233.601,167.850 233.241 C 167.464 232.921,164.615 232.817,158.350 232.892 L 149.400 233.000 149.400 243.000 C 149.400 255.864,149.972 257.962,154.800 262.806 C 157.383 265.397,159.349 266.621,162.800 267.782 C 165.806 268.794,235.783 268.695,238.877 267.674 C 243.522 266.142,248.223 262.335,249.895 258.754 C 252.131 253.964,252.038 255.272,251.914 230.400 L 251.800 207.400 250.707 205.067 C 248.238 199.795,244.301 196.235,238.800 194.300 C 237.753 193.932,228.929 193.756,203.800 193.604 L 170.200 193.400 170.200 175.000 L 170.200 156.600 201.600 156.600 L 233.000 156.600 233.108 164.694 C 233.237 174.350,231.915 173.268,243.400 173.113 L 251.800 173.000 251.911 162.800 C 252.028 152.088,251.963 151.550,250.067 147.618 C 248.045 143.426,243.418 139.755,238.200 138.203 C 235.207 137.313,167.578 137.384,164.644 138.281 M282.092 138.735 C 281.701 138.983,281.609 141.118,281.692 148.028 L 281.800 157.000 329.375 157.102 C 367.171 157.182,377.016 157.100,377.269 156.702 C 377.810 155.849,377.673 139.433,377.120 138.880 C 376.560 138.320,282.971 138.177,282.092 138.735 M26.414 139.574 C 25.883 140.566,25.863 155.187,26.390 156.574 L 26.780 157.600 73.957 157.600 C 99.905 157.600,121.419 157.491,121.767 157.357 C 122.589 157.042,122.733 140.093,121.920 139.280 C 120.966 138.326,26.927 138.615,26.414 139.574 M281.500 193.476 C 280.365 193.772,280.435 210.977,281.574 211.586 C 282.651 212.162,375.349 212.162,376.426 211.586 C 377.154 211.196,377.200 210.665,377.200 202.576 L 377.200 193.980 376.174 193.590 C 375.156 193.203,282.969 193.092,281.500 193.476 M26.100 193.865 C 25.398 194.148,25.379 211.219,26.080 211.920 C 27.034 212.874,121.073 212.585,121.586 211.626 C 122.028 210.800,122.181 195.336,121.757 194.233 C 121.520 193.614,27.617 193.253,26.100 193.865 M282.092 248.735 C 281.701 248.983,281.609 251.118,281.692 258.028 L 281.800 267.000 329.600 267.000 L 377.400 267.000 377.508 258.251 C 377.583 252.133,377.478 249.335,377.159 248.951 C 376.641 248.327,283.069 248.114,282.092 248.735 M26.414 249.574 C 26.169 250.032,26.000 253.552,26.000 258.200 C 26.000 262.848,26.169 266.368,26.414 266.826 C 26.827 267.597,119.792 268.115,121.767 267.357 C 122.589 267.042,122.733 250.093,121.920 249.280 C 120.966 248.326,26.927 248.615,26.414 249.574 M4.400 391.557 C 4.400 391.754,4.670 392.018,5.000 392.145 C 5.365 392.285,5.600 392.145,5.600 391.787 C 5.600 391.464,5.330 391.200,5.000 391.200 C 4.670 391.200,4.400 391.361,4.400 391.557 M394.667 391.467 C 394.181 391.953,394.390 392.379,395.000 392.145 C 395.330 392.018,395.600 391.754,395.600 391.557 C 395.600 391.138,395.049 391.084,394.667 391.467 M391.500 394.676 C 390.668 394.893,390.559 395.600,391.357 395.600 C 391.664 395.600,392.018 395.330,392.145 395.000 C 392.271 394.670,392.336 394.421,392.287 394.446 C 392.239 394.472,391.885 394.575,391.500 394.676 M8.000 395.200 C 8.000 395.420,8.270 395.600,8.600 395.600 C 8.930 395.600,9.200 395.420,9.200 395.200 C 9.200 394.980,8.930 394.800,8.600 394.800 C 8.270 394.800,8.000 394.980,8.000 395.200 " stroke="none" fill="#f4f4f4" fill-rule="evenodd"></path><path id="path1" d="M17.000 0.400 C 16.864 0.620,16.319 0.800,15.789 0.800 C 15.097 0.800,14.890 0.969,15.055 1.400 C 15.218 1.823,15.022 2.000,14.394 2.000 C 13.609 2.000,13.568 1.920,14.051 1.336 C 14.554 0.728,14.524 0.719,13.700 1.232 C 13.205 1.540,12.800 2.109,12.800 2.496 C 12.800 3.276,12.367 3.407,11.770 2.810 C 11.263 2.303,9.200 4.041,9.200 4.975 C 9.200 5.450,8.927 5.622,8.300 5.541 C 7.227 5.402,6.292 5.902,6.623 6.438 C 6.753 6.648,6.621 6.770,6.330 6.710 C 5.994 6.640,5.754 7.080,5.674 7.912 C 5.593 8.753,5.355 9.183,5.011 9.112 C 4.244 8.952,2.318 11.278,2.810 11.770 C 3.362 12.322,3.293 12.800,2.662 12.800 C 2.366 12.800,1.798 13.160,1.400 13.600 C 1.002 14.040,0.869 14.400,1.105 14.400 C 1.340 14.400,1.624 14.175,1.735 13.900 C 1.856 13.601,1.950 13.682,1.968 14.100 C 1.986 14.485,1.730 14.800,1.400 14.800 C 0.811 14.800,0.581 15.902,0.753 17.900 C 0.795 18.395,0.643 18.800,0.415 18.800 C -0.244 18.800,-0.159 381.469,0.500 381.736 C 0.889 381.894,0.879 382.024,0.457 382.320 C 0.078 382.585,0.048 382.782,0.357 382.974 C 0.601 383.124,0.800 383.856,0.800 384.600 C 0.800 385.877,1.332 386.764,1.700 386.102 C 1.793 385.936,1.816 386.020,1.751 386.288 C 1.687 386.557,1.895 387.038,2.213 387.356 C 2.532 387.675,2.623 387.995,2.414 388.068 C 1.925 388.239,4.481 391.200,5.117 391.200 C 5.383 391.200,5.600 391.619,5.600 392.130 C 5.600 393.281,7.151 394.800,8.326 394.800 C 8.807 394.800,9.200 394.988,9.200 395.217 C 9.200 395.658,10.091 396.639,11.377 397.612 C 11.860 397.978,12.040 398.011,11.853 397.700 C 11.688 397.425,11.743 397.200,11.976 397.200 C 12.209 397.200,12.404 397.425,12.410 397.700 C 12.415 397.975,13.090 398.560,13.910 399.000 C 15.403 399.802,379.337 400.547,381.200 399.753 C 381.530 399.612,382.565 399.533,383.500 399.579 C 384.899 399.646,385.206 399.531,385.232 398.930 C 385.249 398.529,385.349 398.411,385.455 398.669 C 385.682 399.227,389.571 397.342,389.886 396.521 C 389.996 396.234,390.331 396.000,390.630 396.000 C 390.950 396.000,391.080 395.752,390.945 395.400 C 390.741 394.870,391.204 394.669,392.237 394.839 C 392.725 394.919,394.733 392.690,394.566 392.254 C 394.470 392.004,395.024 391.274,395.796 390.630 C 396.729 389.853,397.202 389.115,397.206 388.430 C 397.211 387.659,397.303 387.544,397.574 387.972 C 397.840 388.392,398.010 388.125,398.213 386.972 C 398.365 386.108,398.784 385.167,399.145 384.883 C 400.156 384.084,400.156 15.916,399.145 15.117 C 398.784 14.833,398.358 13.880,398.197 13.000 C 397.957 11.690,397.849 11.545,397.598 12.200 C 397.346 12.855,397.265 12.747,397.146 11.600 C 397.057 10.750,396.804 10.239,396.500 10.300 C 396.225 10.355,396.000 10.130,396.000 9.800 C 396.000 9.470,395.730 9.200,395.400 9.200 C 395.070 9.200,394.800 8.866,394.800 8.458 C 394.800 7.313,392.987 5.600,391.776 5.600 C 391.048 5.600,390.780 5.430,390.922 5.059 C 391.036 4.761,390.741 4.196,390.265 3.803 C 389.789 3.410,389.077 2.809,388.683 2.467 C 388.029 1.900,387.989 1.905,388.226 2.522 C 388.373 2.908,388.295 3.200,388.043 3.200 C 387.799 3.200,387.600 2.973,387.600 2.696 C 387.600 2.419,387.221 1.956,386.758 1.667 C 386.295 1.378,386.036 1.334,386.182 1.570 C 386.338 1.823,386.112 2.000,385.636 2.000 C 385.080 2.000,384.897 1.812,385.055 1.400 C 385.288 0.794,384.256 0.568,382.100 0.753 C 381.605 0.795,381.200 0.643,381.200 0.415 C 381.200 0.129,324.939 0.000,200.000 0.000 C 79.467 0.000,18.800 0.134,18.800 0.400 C 18.800 0.620,18.429 0.800,17.976 0.800 C 17.523 0.800,17.264 0.620,17.400 0.400 C 17.536 0.180,17.557 -0.000,17.447 -0.000 C 17.337 -0.000,17.136 0.180,17.000 0.400 M238.200 138.203 C 243.418 139.755,248.045 143.426,250.067 147.618 C 251.963 151.550,252.028 152.088,251.911 162.800 L 251.800 173.000 243.400 173.113 C 231.915 173.268,233.237 174.350,233.108 164.694 L 233.000 156.600 201.600 156.600 L 170.200 156.600 170.200 175.000 L 170.200 193.400 203.800 193.604 C 228.929 193.756,237.753 193.932,238.800 194.300 C 244.301 196.235,248.238 199.795,250.707 205.067 L 251.800 207.400 251.914 230.400 C 252.038 255.272,252.131 253.964,249.895 258.754 C 248.223 262.335,243.522 266.142,238.877 267.674 C 235.783 268.695,165.806 268.794,162.800 267.782 C 159.349 266.621,157.383 265.397,154.800 262.806 C 149.972 257.962,149.400 255.864,149.400 243.000 L 149.400 233.000 158.350 232.892 C 164.615 232.817,167.464 232.921,167.850 233.241 C 168.283 233.601,168.400 235.388,168.400 241.651 L 168.400 249.605 200.700 249.502 L 233.000 249.400 233.104 231.226 C 233.186 216.952,233.100 212.984,232.704 212.732 C 232.427 212.556,217.558 212.409,199.662 212.406 C 170.947 212.401,166.863 212.324,164.908 211.756 C 159.791 210.269,155.223 206.369,152.778 201.400 L 151.400 198.600 151.400 175.000 C 151.400 153.309,151.457 151.290,152.100 150.039 C 152.485 149.290,152.800 148.534,152.800 148.359 C 152.800 145.816,159.983 139.704,164.644 138.281 C 167.578 137.384,235.207 137.313,238.200 138.203 M377.120 138.880 C 377.673 139.433,377.810 155.849,377.269 156.702 C 377.016 157.100,367.171 157.182,329.375 157.102 L 281.800 157.000 281.692 148.028 C 281.609 141.118,281.701 138.983,282.092 138.735 C 282.971 138.177,376.560 138.320,377.120 138.880 M121.920 139.280 C 122.733 140.093,122.589 157.042,121.767 157.357 C 121.419 157.491,99.905 157.600,73.957 157.600 L 26.780 157.600 26.390 156.574 C 25.863 155.187,25.883 140.566,26.414 139.574 C 26.927 138.615,120.966 138.326,121.920 139.280 M376.174 193.590 L 377.200 193.980 377.200 202.576 C 377.200 210.665,377.154 211.196,376.426 211.586 C 375.349 212.162,282.651 212.162,281.574 211.586 C 280.435 210.977,280.365 193.772,281.500 193.476 C 282.969 193.092,375.156 193.203,376.174 193.590 M121.757 194.233 C 122.181 195.336,122.028 210.800,121.586 211.626 C 121.073 212.585,27.034 212.874,26.080 211.920 C 25.379 211.219,25.398 194.148,26.100 193.865 C 27.617 193.253,121.520 193.614,121.757 194.233 M377.159 248.951 C 377.478 249.335,377.583 252.133,377.508 258.251 L 377.400 267.000 329.600 267.000 L 281.800 267.000 281.692 258.028 C 281.609 251.118,281.701 248.983,282.092 248.735 C 283.069 248.114,376.641 248.327,377.159 248.951 M121.920 249.280 C 122.733 250.093,122.589 267.042,121.767 267.357 C 119.792 268.115,26.827 267.597,26.414 266.826 C 26.169 266.368,26.000 262.848,26.000 258.200 C 26.000 253.552,26.169 250.032,26.414 249.574 C 26.927 248.615,120.966 248.326,121.920 249.280 " stroke="none" fill="#040404" fill-rule="evenodd"></path></g></svg>`;
      this.widgetCloseIcon = `<svg id="svg" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="50" height="50" viewBox="0, 0, 400,400"><g id="svgg"><path id="path0" d="M17.400 0.400 C 17.264 0.620,17.523 0.800,17.976 0.800 C 18.429 0.800,18.800 0.620,18.800 0.400 C 18.800 0.180,18.541 0.000,18.224 0.000 C 17.907 0.000,17.536 0.180,17.400 0.400 M381.200 0.400 C 381.200 0.919,382.279 0.919,382.600 0.400 C 382.736 0.180,382.477 -0.000,382.024 -0.000 C 381.571 -0.000,381.200 0.180,381.200 0.400 M13.996 1.404 C 13.594 1.889,13.619 2.000,14.127 2.000 C 14.874 2.000,15.362 1.348,14.852 1.032 C 14.653 0.909,14.268 1.077,13.996 1.404 M385.055 1.400 C 384.900 1.806,385.076 2.000,385.600 2.000 C 386.124 2.000,386.300 1.806,386.145 1.400 C 386.018 1.070,385.773 0.800,385.600 0.800 C 385.427 0.800,385.182 1.070,385.055 1.400 M11.445 2.627 C 11.335 2.912,11.530 3.081,11.906 3.026 C 12.264 2.973,12.616 2.751,12.689 2.532 C 12.883 1.950,11.669 2.043,11.445 2.627 M8.000 5.000 C 7.584 5.501,7.642 5.600,8.351 5.600 C 8.839 5.600,9.200 5.345,9.200 5.000 C 9.200 4.670,9.042 4.400,8.849 4.400 C 8.656 4.400,8.274 4.670,8.000 5.000 M391.010 4.783 C 390.867 5.016,391.038 5.317,391.392 5.452 C 392.272 5.790,392.546 5.419,391.845 4.838 C 391.451 4.510,391.189 4.493,391.010 4.783 M4.881 8.102 C 4.508 8.552,4.487 8.807,4.807 9.004 C 5.399 9.370,5.702 9.023,5.535 8.169 C 5.413 7.544,5.349 7.537,4.881 8.102 M394.800 8.600 C 394.800 8.930,394.980 9.200,395.200 9.200 C 395.420 9.200,395.600 8.930,395.600 8.600 C 395.600 8.270,395.420 8.000,395.200 8.000 C 394.980 8.000,394.800 8.270,394.800 8.600 M2.500 11.465 C 1.810 11.743,1.869 12.800,2.575 12.800 C 2.904 12.800,3.124 12.457,3.090 12.000 C 3.057 11.560,3.023 11.214,3.015 11.232 C 3.007 11.249,2.775 11.354,2.500 11.465 M0.000 17.976 C 0.000 18.429,0.180 18.800,0.400 18.800 C 0.620 18.800,0.800 18.541,0.800 18.224 C 0.800 17.907,0.620 17.536,0.400 17.400 C 0.180 17.264,0.000 17.523,0.000 17.976 M152.587 138.400 C 149.890 139.239,147.200 143.227,147.200 146.384 C 147.200 149.397,147.676 150.156,163.181 171.867 C 164.621 173.884,167.150 177.442,168.800 179.774 C 170.450 182.105,172.880 185.503,174.200 187.324 C 176.949 191.116,179.616 194.939,180.200 195.925 C 180.420 196.296,180.825 196.744,181.100 196.920 C 181.375 197.096,181.600 197.486,181.600 197.787 C 181.600 198.087,181.735 198.393,181.900 198.467 C 182.380 198.680,185.200 202.960,185.200 203.474 C 185.200 203.731,183.498 206.250,181.419 209.071 C 179.339 211.892,177.188 214.830,176.639 215.600 C 175.471 217.238,169.720 225.169,166.014 230.253 C 164.592 232.204,161.551 236.410,159.256 239.600 C 156.961 242.790,154.058 246.750,152.805 248.400 C 151.552 250.050,150.064 252.136,149.499 253.036 C 148.933 253.936,148.171 254.972,147.805 255.338 C 140.010 263.132,148.007 275.883,157.296 270.471 C 158.224 269.930,168.400 256.823,168.400 256.167 C 168.400 256.044,168.625 255.694,168.900 255.391 C 169.175 255.087,170.799 252.895,172.510 250.519 C 179.024 241.471,184.019 234.582,184.404 234.115 C 184.624 233.848,185.208 233.038,185.702 232.315 C 190.240 225.671,196.679 217.200,197.191 217.200 C 197.538 217.200,198.266 217.886,198.811 218.724 C 199.355 219.562,201.330 222.375,203.200 224.975 C 209.881 234.264,211.440 236.443,214.400 240.626 C 216.050 242.959,218.750 246.751,220.400 249.054 C 222.050 251.356,224.750 255.139,226.400 257.460 C 236.051 271.034,236.412 271.378,241.024 271.378 C 244.962 271.378,247.177 269.873,248.799 266.094 C 250.368 262.440,249.753 260.542,244.697 253.437 C 239.252 245.784,235.241 240.158,233.000 237.029 C 231.680 235.185,230.330 233.282,230.000 232.800 C 229.670 232.318,228.320 230.415,227.000 228.571 C 225.680 226.727,223.520 223.684,222.200 221.808 C 220.014 218.701,218.677 216.830,211.500 206.823 C 208.659 202.862,208.465 203.889,213.300 197.269 C 215.555 194.181,217.670 191.265,218.000 190.788 C 218.330 190.311,220.274 187.644,222.319 184.861 C 224.365 182.077,226.343 179.350,226.714 178.800 C 227.086 178.250,229.174 175.370,231.355 172.400 C 233.536 169.430,235.878 166.206,236.560 165.236 C 237.242 164.266,239.645 160.979,241.900 157.932 C 244.155 154.886,246.000 152.237,246.000 152.045 C 246.000 151.854,246.246 151.494,246.546 151.245 C 249.111 149.116,247.621 141.600,244.164 139.231 C 239.753 136.209,235.068 137.976,230.453 144.400 C 229.110 146.270,227.783 148.112,227.505 148.494 C 227.227 148.875,225.560 151.189,223.800 153.635 C 216.050 164.408,213.579 167.827,213.260 168.219 C 213.073 168.450,212.229 169.620,211.387 170.819 C 208.934 174.309,203.840 181.357,203.402 181.868 C 203.181 182.125,201.842 183.970,200.426 185.968 C 196.989 190.819,198.016 191.427,189.776 179.661 C 187.363 176.215,182.806 169.819,180.336 166.410 C 179.622 165.425,176.925 161.645,174.341 158.010 C 171.758 154.374,168.410 149.690,166.902 147.600 C 165.394 145.510,163.654 143.041,163.035 142.113 C 160.763 138.708,156.485 137.188,152.587 138.400 M4.400 391.557 C 4.400 391.754,4.670 392.018,5.000 392.145 C 5.365 392.285,5.600 392.145,5.600 391.787 C 5.600 391.464,5.330 391.200,5.000 391.200 C 4.670 391.200,4.400 391.361,4.400 391.557 M394.667 391.467 C 394.181 391.953,394.390 392.379,395.000 392.145 C 395.330 392.018,395.600 391.754,395.600 391.557 C 395.600 391.138,395.049 391.084,394.667 391.467 M391.500 394.676 C 390.668 394.893,390.559 395.600,391.357 395.600 C 391.664 395.600,392.018 395.330,392.145 395.000 C 392.271 394.670,392.336 394.421,392.287 394.446 C 392.239 394.472,391.885 394.575,391.500 394.676 M8.000 395.200 C 8.000 395.420,8.270 395.600,8.600 395.600 C 8.930 395.600,9.200 395.420,9.200 395.200 C 9.200 394.980,8.930 394.800,8.600 394.800 C 8.270 394.800,8.000 394.980,8.000 395.200 " stroke="none" fill="#f7f7f7" fill-rule="evenodd"></path><path id="path1" d="M17.000 0.400 C 16.864 0.620,16.313 0.800,15.776 0.800 C 15.232 0.800,14.844 1.011,14.900 1.276 C 14.955 1.538,14.646 1.829,14.213 1.922 C 13.501 2.076,13.482 2.024,14.013 1.382 C 14.560 0.719,14.541 0.708,13.726 1.216 C 13.245 1.515,12.759 2.114,12.646 2.546 C 12.487 3.154,12.318 3.230,11.901 2.884 C 11.237 2.333,9.200 3.910,9.200 4.975 C 9.200 5.450,8.927 5.622,8.300 5.541 C 7.227 5.402,6.292 5.902,6.623 6.438 C 6.753 6.648,6.621 6.770,6.330 6.710 C 5.994 6.640,5.754 7.080,5.674 7.912 C 5.593 8.753,5.355 9.183,5.011 9.112 C 4.244 8.952,2.318 11.278,2.810 11.770 C 3.362 12.322,3.293 12.800,2.662 12.800 C 2.366 12.800,1.798 13.160,1.400 13.600 C 1.002 14.040,0.869 14.400,1.105 14.400 C 1.340 14.400,1.624 14.175,1.735 13.900 C 1.856 13.601,1.950 13.682,1.968 14.100 C 1.986 14.485,1.730 14.800,1.400 14.800 C 0.811 14.800,0.581 15.902,0.753 17.900 C 0.795 18.395,0.643 18.800,0.415 18.800 C -0.244 18.800,-0.159 381.469,0.500 381.736 C 0.889 381.894,0.879 382.024,0.457 382.320 C 0.078 382.585,0.048 382.782,0.357 382.974 C 0.601 383.124,0.800 383.856,0.800 384.600 C 0.800 385.877,1.332 386.764,1.700 386.102 C 1.793 385.936,1.816 386.020,1.751 386.288 C 1.687 386.557,1.895 387.038,2.213 387.356 C 2.532 387.675,2.623 387.995,2.414 388.068 C 1.925 388.239,4.481 391.200,5.117 391.200 C 5.383 391.200,5.600 391.619,5.600 392.130 C 5.600 393.281,7.151 394.800,8.326 394.800 C 8.807 394.800,9.200 394.988,9.200 395.217 C 9.200 395.658,10.091 396.639,11.377 397.612 C 11.860 397.978,12.040 398.011,11.853 397.700 C 11.688 397.425,11.743 397.200,11.976 397.200 C 12.209 397.200,12.404 397.425,12.410 397.700 C 12.415 397.975,13.090 398.560,13.910 399.000 C 15.403 399.802,379.337 400.547,381.200 399.753 C 381.530 399.612,382.565 399.533,383.500 399.579 C 384.899 399.646,385.206 399.531,385.232 398.930 C 385.249 398.529,385.349 398.411,385.455 398.669 C 385.682 399.227,389.571 397.342,389.886 396.521 C 389.996 396.234,390.331 396.000,390.630 396.000 C 390.950 396.000,391.080 395.752,390.945 395.400 C 390.741 394.870,391.204 394.669,392.237 394.839 C 392.725 394.919,394.733 392.690,394.566 392.254 C 394.470 392.004,395.024 391.274,395.796 390.630 C 396.729 389.853,397.202 389.115,397.206 388.430 C 397.211 387.659,397.303 387.544,397.574 387.972 C 397.840 388.392,398.010 388.125,398.213 386.972 C 398.365 386.108,398.784 385.167,399.145 384.883 C 400.156 384.084,400.156 15.916,399.145 15.117 C 398.784 14.833,398.358 13.880,398.197 13.000 C 397.957 11.690,397.849 11.545,397.598 12.200 C 397.346 12.855,397.265 12.747,397.146 11.600 C 397.057 10.750,396.804 10.239,396.500 10.300 C 396.225 10.355,396.000 10.130,396.000 9.800 C 396.000 9.470,395.730 9.200,395.400 9.200 C 395.070 9.200,394.800 8.866,394.800 8.458 C 394.800 7.437,393.105 5.698,391.951 5.535 C 391.428 5.461,391.000 5.207,391.000 4.971 C 391.000 4.546,390.615 4.122,388.870 2.622 C 388.101 1.962,388.005 1.947,388.226 2.522 C 388.373 2.908,388.295 3.200,388.043 3.200 C 387.799 3.200,387.600 2.973,387.600 2.696 C 387.600 2.419,387.221 1.956,386.758 1.667 C 386.295 1.378,386.036 1.334,386.182 1.570 C 386.338 1.823,386.112 2.000,385.636 2.000 C 385.080 2.000,384.897 1.812,385.055 1.400 C 385.288 0.794,384.256 0.568,382.100 0.753 C 381.605 0.795,381.200 0.643,381.200 0.415 C 381.200 0.129,324.939 0.000,200.000 0.000 C 79.467 0.000,18.800 0.134,18.800 0.400 C 18.800 0.620,18.429 0.800,17.976 0.800 C 17.523 0.800,17.264 0.620,17.400 0.400 C 17.536 0.180,17.557 -0.000,17.447 -0.000 C 17.337 -0.000,17.136 0.180,17.000 0.400 M160.589 139.419 C 161.315 139.972,162.415 141.185,163.035 142.113 C 163.654 143.041,165.394 145.510,166.902 147.600 C 168.410 149.690,171.758 154.374,174.341 158.010 C 176.925 161.645,179.622 165.425,180.336 166.410 C 182.806 169.819,187.363 176.215,189.776 179.661 C 198.016 191.427,196.989 190.819,200.426 185.968 C 201.842 183.970,203.181 182.125,203.402 181.868 C 203.840 181.357,208.934 174.309,211.387 170.819 C 212.229 169.620,213.073 168.450,213.260 168.219 C 213.579 167.827,216.050 164.408,223.800 153.635 C 225.560 151.189,227.227 148.875,227.505 148.494 C 227.783 148.112,229.110 146.270,230.453 144.400 C 235.068 137.976,239.753 136.209,244.164 139.231 C 247.621 141.600,249.111 149.116,246.546 151.245 C 246.246 151.494,246.000 151.854,246.000 152.045 C 246.000 152.237,244.155 154.886,241.900 157.932 C 239.645 160.979,237.242 164.266,236.560 165.236 C 235.878 166.206,233.536 169.430,231.355 172.400 C 229.174 175.370,227.086 178.250,226.714 178.800 C 226.343 179.350,224.365 182.077,222.319 184.861 C 220.274 187.644,218.330 190.311,218.000 190.788 C 217.670 191.265,215.555 194.181,213.300 197.269 C 208.465 203.889,208.659 202.862,211.500 206.823 C 218.677 216.830,220.014 218.701,222.200 221.808 C 223.520 223.684,225.680 226.727,227.000 228.571 C 228.320 230.415,229.670 232.318,230.000 232.800 C 230.330 233.282,231.680 235.185,233.000 237.029 C 235.241 240.158,239.252 245.784,244.697 253.437 C 249.753 260.542,250.368 262.440,248.799 266.094 C 247.177 269.873,244.962 271.378,241.024 271.378 C 236.412 271.378,236.051 271.034,226.400 257.460 C 224.750 255.139,222.050 251.356,220.400 249.054 C 218.750 246.751,216.050 242.959,214.400 240.626 C 211.440 236.443,209.881 234.264,203.200 224.975 C 201.330 222.375,199.355 219.562,198.811 218.724 C 198.266 217.886,197.538 217.200,197.191 217.200 C 196.679 217.200,190.240 225.671,185.702 232.315 C 185.208 233.038,184.624 233.848,184.404 234.115 C 184.019 234.582,179.024 241.471,172.510 250.519 C 170.799 252.895,169.175 255.087,168.900 255.391 C 168.625 255.694,168.400 256.044,168.400 256.167 C 168.400 256.823,158.224 269.930,157.296 270.471 C 148.007 275.883,140.010 263.132,147.805 255.338 C 148.171 254.972,148.933 253.936,149.499 253.036 C 150.064 252.136,151.552 250.050,152.805 248.400 C 154.058 246.750,156.961 242.790,159.256 239.600 C 161.551 236.410,164.592 232.204,166.014 230.253 C 169.720 225.169,175.471 217.238,176.639 215.600 C 177.188 214.830,179.339 211.892,181.419 209.071 C 183.498 206.250,185.200 203.731,185.200 203.474 C 185.200 202.960,182.380 198.680,181.900 198.467 C 181.735 198.393,181.600 198.087,181.600 197.787 C 181.600 197.486,181.375 197.096,181.100 196.920 C 180.825 196.744,180.420 196.296,180.200 195.925 C 179.616 194.939,176.949 191.116,174.200 187.324 C 172.880 185.503,170.450 182.105,168.800 179.774 C 167.150 177.442,164.621 173.884,163.181 171.867 C 147.676 150.156,147.200 149.397,147.200 146.384 C 147.200 139.827,155.478 135.520,160.589 139.419 " stroke="none" fill="#040404" fill-rule="evenodd"></path></g></svg>`;
      widget.innerHTML = this.widgetDefaultIcon;
      this.widget = widget;
      document.body.appendChild(this.widget);
      if (!published) {
        this.mountUnpublishedIndicator();
      }
    };

    toggleMessengerIframe = (published) => {
      if (this.frameOpen) {
        this.wrapper.style.height = 0;
        this.widget.style.bottom = "50px";
        this.widget.style.right = "50px";
        this.widget.style.top = "unset";
        this.widget.innerHTML = this.widgetDefaultIcon;

        if (!published) {
          this.mountUnpublishedIndicator();
        }

        this.frameOpen = false;
      
        if (this.iframe.contentWindow) {
          this.iframe.contentWindow.postMessage("stopActiveSequence", "*");
          
          
        }
      } else {
        this.iframe.contentWindow.postMessage("selphio__overlay", "*");
        this.wrapper.style.height = "100%";
        this.widget.style.bottom = "unset";
        this.widget.style.right = "0px";
        this.widget.style.top = "0px";
        this.widget.innerHTML = this.widgetCloseIcon;
        this.frameOpen = true;
        console.log('accessing content')

      //   this.iframe.contentWindow.document.getElementsByTagName("body")[0].style.backgroundColor = "blue";
      //   console.log( this.iframe.contentWindow.document.getElementsByClassName('selphio__overlay_dots'))
      // var layer =  this.iframe.contentWindow.document.getElementsByClassName('selphio__overlay_dots')
      // layer.remove();

      }
    };
  };
}

(async function (window) {
  var test = new SelphShim();
  window.slphemb = test;
  var embedScript = document.querySelector(
    'script[data-id="tslphmbed"][data-selphid]'
  );
  await window.slphemb.init(
    embedScript.getAttribute("data-selphid"),
    embedScript.getAttribute("data-local") === null
  );
})(window);
